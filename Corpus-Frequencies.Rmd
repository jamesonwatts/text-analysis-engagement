---
title: "Corpus-Frequencies"
output:
  html_document: 
    fig_width: 10.5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(tidytext)
library(tidylo)
library(wordcloud)
eng <- read_rds("terms.rds") %>% 
  left_join(read_rds("articles.rds")) %>% 
  filter(year < 2019)
periods <- c("< 2005","2005-2009","2010-2014","2015 <")
disciplines <- c("Marketing","Management","Tourism","Public")
```

## Look at the top words across all articles and years
```{r}
eng %>%
  group_by(term) %>% 
  summarise(word_count = sum(count)) %>% 
  top_n(25, word_count) %>% 
  mutate(term = reorder(term, word_count)) %>% 
  ggplot(aes(term, word_count)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```

## Look at wordcloud of top words
```{r}
eng %>% 
  group_by(term) %>% 
  summarise(word_count = sum(count)) %>% 
  with(wordcloud(term, word_count, random.order = FALSE, max.words = 50))

```

## Top 20 words by count in each time period
```{r, fig.height=6}
eng %>% 
  group_by(time_period, term) %>%
  summarise(word_count=sum(count)) %>% 
  top_n(20, word_count) %>%
  ungroup %>%
  ggplot(aes(reorder_within(term, word_count, time_period), word_count, fill = time_period)) +
    geom_col(show.legend = FALSE) +
    scale_x_reordered() +
    facet_wrap(~time_period, scales = "free") +
    coord_flip()+
    labs(x = NULL, y="Word Counts")
```

## Top words by discipline

```{r, fig.height=6}
for(p in periods){
  print(eng %>% 
    filter(time_period==p) %>% 
    group_by(research_field, term) %>%
    summarise(word_count=sum(count)) %>% 
    top_n(20, word_count) %>%
    ungroup %>%
    ggplot(aes(reorder_within(term, word_count, research_field), word_count, fill = research_field)) +
      geom_col(show.legend = FALSE) +
      scale_x_reordered() +
      facet_wrap(~research_field, scales = "free") +
      coord_flip()+
      labs(x = NULL, y="Word Counts", title = p))
}
```


## Number of articles and the term 'egag' by year
```{r}
eng %>% 
  filter(term=="engag") %>% 
  group_by(year) %>%
  summarize(
    document_count = n_distinct(document),
    engag_term_count = sum(count)
      ) %>%
  gather(key = "type", value = "count",2:3) %>%
  ggplot(aes(year,count)) +
    geom_line()+
    facet_wrap(~ type, scales = "free")

```

## Growth of importance in the term 'engag' over time conditioned by amount of text each year
Using the weighted log odds binding as proposed by [Julia Silge in the tidylo package](https://juliasilge.com/blog/introducing-tidylo/)

```{r, message=FALSE}
eng %>%
  filter(year > 1995) %>% 
  bind_log_odds(document, term, count) %>% 
  filter(term=='engag') %>% 
  group_by(year) %>% 
  summarise(log_odds=mean(log_odds)) %>% 
  ggplot(aes(year,log_odds)) +
    geom_point(shape=1, alpha=0.5)+
    geom_smooth(method = lm)+
    labs(y = "Log odds ratio, weighted by uninformative Dirichlet prior",
         x = "Year")
```

## Number of articles by discipline

```{r}
eng %>% 
  filter(year>2004) %>% 
  group_by(research_field,year_derived) %>% 
  summarise(count=n_distinct(document)) %>% 
  ggplot(aes(as.numeric(year_derived), count, color=research_field)) +
    geom_line()+
    geom_smooth()
```

## Use of the term eng in each discipline over the years
```{r}
eng %>% 
  filter(year>2005) %>% 
  filter(term=="engag") %>% 
  group_by(research_field,year) %>%
  summarize(
    document_count = n_distinct(document),
    engag_term_count = sum(count)
    ) %>%
  ungroup %>% 
  ggplot(aes(year,engag_term_count, color=research_field)) +
    geom_line()+
    geom_smooth()

```

## Log odds of the term engag in Marketing and Management

```{r, message=FALSE}
eng %>%
  filter(year > 1995) %>% 
  filter(research_field=="Management" | research_field=="Marketing") %>% 
  bind_log_odds(document, term, count) %>% 
  filter(term=='engag') %>% 
  group_by(research_field, year) %>% 
  summarise(log_odds=mean(log_odds)) %>% 
  ggplot(aes(year,log_odds, color=research_field)) +
    geom_point()+
    labs(y = "Log odds ratio, weighted by uninformative Dirichlet prior",
         x = "Year")
```

## Comparison of words used in management vs marketing from different periods 

Filtered out words that appear less than 1000 times in the corpus

```{r, warning=FALSE}
library(scales)

for(p in periods){
  print(eng %>% 
    filter(time_period==p) %>% 
    filter(research_field %in% c("Marketing","Management")) %>% 
    filter(total>1000) %>% 
    group_by(research_field, term) %>%
    summarize(n = sum(count)) %>% 
    mutate(proportion = n / sum(n)) %>% 
    pivot_wider(id_cols = term, names_from = research_field, values_from = proportion) %>% 
    ggplot(aes(x = Management, y = Marketing, color = abs(Marketing - Management))) +
      geom_abline(color = "gray40", lty = 2) +
      geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
      geom_text(aes(label = term), check_overlap = TRUE, vjust = 1.5) +
      scale_x_log10(labels = percent_format()) +
      scale_y_log10(labels = percent_format()) +
      scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
      theme(legend.position="none") +
      labs(y = "Marketing", x = "Management", title = p))
}
```



## Top 10 Journals using the term "engagement"

```{r}
eng %>% 
  filter(term=="engag") %>% 
  group_by(periodical_short) %>% 
  summarize(term_count=sum(count)) %>%
  top_n(10,term_count) %>% 
  ggplot(aes(reorder(periodical_short,+term_count),term_count)) +
    geom_col(show.legend = FALSE) +
    labs(x = NULL, y = "Count of term 'engag'") +
    coord_flip() 
```

## Top 10 journals in each period
```{r}
eng %>% 
  filter(term=="engag") %>% 
  group_by(time_period, periodical_short) %>% 
  summarize(word_count=sum(count)) %>%
  top_n(10,word_count) %>% 
  ungroup %>%
  ggplot(aes(reorder_within(periodical_short, word_count, time_period), word_count, fill = time_period)) +
    geom_col(show.legend = FALSE) +
    scale_x_reordered() +
    facet_wrap(~time_period, scales = "free") +
    coord_flip()+
    labs(x = NULL, y=NULL)+
    theme(
      axis.text.y = element_text(angle = 40),
      plot.margin = unit(c(5.5, 5.5, 50, 5.5), "points")
    )
```

## Top 10 journal in each period by discipline
```{r, fig.height=6}
for(p in periods){
  print(eng %>% 
    filter(time_period==p) %>% 
    group_by(research_field, periodical_short) %>% 
    summarize(word_count=sum(count)) %>%
    top_n(10,word_count) %>% 
    ungroup %>%
    ggplot(aes(reorder_within(periodical_short, word_count, research_field), word_count, fill = research_field)) +
      geom_col(show.legend = FALSE) +
      scale_x_reordered() +
      facet_wrap(~research_field, scales = "free") +
      coord_flip()+
      labs(x = NULL, y=NULL, title = p)+
      theme(
        axis.text.y = element_text(angle = 40),
        plot.margin = unit(c(5.5, 5.5, 50, 5.5), "points")
      ))
}    

```


## Authors that use the term engagement the most

```{r, warning=FALSE}
eng %>% 
  filter(term=="engag") %>%
  separate(author, c("author_1","author_2","author_3","author_4","author_5","author_6"),sep = ";") %>% 
  gather(key = "author_num", value = "author",5:10, na.rm = TRUE) %>%
  mutate(author = str_trim(author)) %>% 
  group_by(author) %>% 
  summarise(term_count=sum(count)) %>% 
  top_n(10,term_count) %>% 
  ungroup %>% 
  ggplot(aes(reorder(author,+term_count),term_count)) +
    geom_col(show.legend = FALSE) +
    labs(x = NULL, y = "Count of term 'engag'") +
    coord_flip() 
```

## Authors that use the term engagment the most by time period

```{r, warning=FALSE}
eng %>% 
  filter(term=="engag") %>%
  separate(author, c("author_1","author_2","author_3","author_4","author_5","author_6"),sep = ";") %>% 
  gather(key = "author_num", value = "author",5:10, na.rm = TRUE) %>%
  mutate(author = str_trim(author)) %>% 
  group_by(time_period, author) %>% 
  summarise(term_count=sum(count)) %>% 
  top_n(10,term_count) %>% 
  ungroup %>% 
  ggplot(aes(reorder_within(author, term_count, time_period), term_count, fill = time_period)) +
    geom_col(show.legend = FALSE) +
    scale_x_reordered() +
    facet_wrap(~time_period, scales = "free") +
    coord_flip()+
    labs(x = NULL, y=NULL)
  
```

## that use the term engagment the most my time period and discipline
```{r, warning=FALSE, fig.height=6}
for(p in periods){
  print(eng %>% 
    filter(term=="engag") %>%
    filter(time_period==p) %>% 
    separate(author, c("author_1","author_2","author_3","author_4","author_5","author_6"),sep = ";") %>% 
    gather(key = "author_num", value = "author",5:10, na.rm = TRUE) %>%
    mutate(author = str_trim(author)) %>% 
    group_by(research_field, author) %>% 
    summarise(term_count=sum(count)) %>% 
    top_n(10,term_count) %>% 
    ungroup %>% 
    ggplot(aes(reorder_within(author, term_count, research_field), term_count, fill = research_field)) +
      geom_col(show.legend = FALSE) +
      scale_x_reordered() +
      facet_wrap(~research_field, scales = "free") +
      coord_flip()+
      labs(x = NULL, y=NULL, title = p))
  
}

```

## Top Keywords by discipline
```{r, warning=FALSE}
keywords <- eng %>% 
  group_by(document) %>% 
  summarise(
    keywords=first(keywords),
    time_period=first(time_period),
    research_field=first(research_field)
  ) %>% 
  mutate(keywords = tolower(keywords)) %>%  #to lower
  separate(keywords, c("k_1","k_2","k_3","k_4","k_5","k_6"),sep = ";") %>% 
  gather(key = "keyword_num", value = "keyword",2:7, na.rm = TRUE) %>%
  mutate(keyword = str_trim(keyword))

keywords %>% 
  group_by(research_field, keyword) %>%
  summarise(word_count=n()) %>% 
  top_n(10, word_count) %>%
  ungroup %>%
  ggplot(aes(reorder_within(keyword, word_count, research_field), word_count, fill = research_field)) +
    geom_col(show.legend = FALSE) +
    scale_x_reordered() +
    facet_wrap(~research_field, scales = "free") +
    coord_flip()+
    labs(x = NULL, y="Word Counts")
```


